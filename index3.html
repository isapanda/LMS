<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="utf8">
	<title>ccchart</title>	
	<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js" charset="utf-8"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="http://knockoutjs.com/downloads/knockout-3.4.2.js"></script>
	<title>Chart.js sample</title>
</head>
<body>

<div class="pure-u-1">
	
	<div>
		<canvas id="chart" height="450" width="600"></canvas>
	</div>
	
</div>

<script src="/socket.io/socket.io.js"></script>
<script type="text/javascript">
	function MainViewModel() {
	var socket = io.connect();
	
	sockets(mycallback);

	function sockets(acallback){
	var i2cdata = [];
	
	socket.on('chart', function (data, fn) {
        if(data.str){
      		 var datas = data.str.split(",");
	        	}	

	i2cdata.shift();
	i2cdata.push(datas[2]);
	
	
	});
	console.log(i2cdata);
	acallback(i2cdata);}

	function mycallback(i2cdata){
	var ctx = document.getElementById('chart').getContext('2d');
	var myChart = new Chart(ctx, {
  	type: 'line',
 	 data: {
   	 labels: [1,2,3,4,5],
  	  datasets: [
		{label: 'apples', data: i2cdata, backgroundColor: "rgba(153,255,51,0.4)" }, 
		{ label: 'oranges', data: [55, 29, 5, 5, 2, 3, 10], backgroundColor: "rgba(255,153,0,0.4)"}
	    	      ]}});}
   	}
	
	var vm = MainViewModel();
	ko.applyBindings(vm);
	
</script>
	
</body>
</html>